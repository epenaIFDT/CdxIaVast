<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chatbot Vastec Web</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
      margin: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 540px;
      margin: 48px auto;
      background: #fff;
      padding: 32px 28px 24px 28px;
      border-radius: 16px;
      box-shadow: 0 4px 24px #0f2027cc;
      border: 1px solid #e0e0e0;
      transition: box-shadow 0.2s;
    }
    @media (max-width: 900px) {
      .container {
        max-width: 98vw;
        margin-top: 18px;
        padding: 18px 6vw;
      }
      h2 {
        font-size: 1.3rem;
      }
    }
    @media (max-width: 600px) {
      .container { max-width: 99vw; padding: 8vw 2vw; margin-top: 8px; }
      h2 { font-size: 1rem; }
      #historial, #historial .chat-item, #historial .user, #historial .bot, #historial .respuesta, #historial .respuesta-bot {
        font-size: 0.45rem !important;
        line-height: 1.35;
      }
      #historial { min-height: 120px; padding: 8px 4px; }
      #historial .chat-item { padding: 7px 5px; margin-bottom: 10px; }
      #historial .user, #historial .bot { gap: 4px; }
      #historial .respuesta, #historial .respuesta-bot { padding: 5px 7px; word-break: break-word; }
      #consultas-frecuentes { max-height: 110px; padding: 8px 6px; overflow-y: auto; font-size: 0.92rem; }
      #consultas-frecuentes li { font-size: 0.92rem; padding: 5px 7px; }
      input[type="text"] { font-size: 0.92rem; padding: 6px 8px; }
      button { font-size: 0.92rem; padding: 7px 10px; }
    }
    h2 {
      color: #0f2027;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    h2 .fa-robot {
      color: #0077cc;
      font-size: 1.5rem;
    }
    label {
      font-size: 1.08rem;
      color: #2c5364;
      font-weight: 500;
    }
    input[type="text"] {
      font-size: 1.08rem;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #b0b0b0;
      width: 100%;
      margin-top: 4px;
      margin-bottom: 12px;
      transition: border-color 0.2s;
    }
    input[type="text"]:focus {
      border-color: #0077cc;
      outline: none;
    }
    button {
      font-size: 1.08rem;
      padding: 8px 18px;
      border-radius: 6px;
      border: none;
      background: linear-gradient(90deg, #0077cc 0%, #2c5364 100%);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 4px;
      transition: background 0.2s;
    }
    button:hover {
      background: linear-gradient(90deg, #2c5364 0%, #0077cc 100%);
    }
    #historial {
      margin-top: 24px;
      max-height: 420px;
      min-height: 180px;
      overflow-y: auto;
      background: linear-gradient(135deg, #e9f7fe 0%, #f8fafd 100%);
      border-radius: 12px;
      border: 1.5px solid #0077cc44;
      padding: 18px 16px;
      box-shadow: 0 2px 12px #0077cc22;
      font-size: 1.08rem;
      word-break: break-word;
    }
    .chat-item {
      margin-bottom: 22px;
      padding-bottom: 10px;
      border-bottom: 1px solid #cce6ff;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px #0077cc11;
      padding: 12px 14px;
    }
    .chat-item:last-child {
      border-bottom: none;
    }
    .user {
      color: #0f2027;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1.08rem;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #b0b0b0;
      width: 100%;
      margin-top: 4px;
      margin-bottom: 12px;
      transition: border-color 0.2s;
      outline: none;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.98rem;
    }
    .bot .fa-robot {
      color: #2c5364;
    }
    .respuesta {
      color: #222;
      margin-left: 24px;
      font-size: 1.08rem;
      margin-top: 4px;
      margin-bottom: 4px;
      line-height: 1.5;
      word-break: break-word;
      background: #f8fafd;
      border-radius: 6px;
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
  }
  /* Estilo profesional para respuestas del chatbot */
  .respuesta-bot {
    background: linear-gradient(90deg, #e9f7fe 0%, #cce6ff 100%);
    color: #1a2a3a;
    font-weight: 500;
      font-size: 1.08rem;
      padding: 8px 18px;
      border-radius: 6px;
      border: none;
      background: linear-gradient(90deg, #0077cc 0%, #2c5364 100%);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 4px;
      transition: background 0.2s;
      outline: none;
    }
    button:active {
      background: #005fa3;
    }
    #consultas-frecuentes {
      margin-top: 24px;
      background: #e9f7fe;
      border-radius: 8px;
      padding: 16px 14px;
      box-shadow: 0 1px 4px #0077cc22;
      border: 1px solid #cce6ff;
      max-height: 140px;
      overflow-y: auto;
      transition: box-shadow 0.2s;
      scrollbar-width: thin;
      scrollbar-color: #0077cc #e9f7fe;
    }
    #consultas-frecuentes h3 {
      color: #0077cc;
      font-size: 1.15rem;
      margin-bottom: 8px;
      font-weight: 600;
    }
    #consultas-frecuentes ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: block;
    }
    #consultas-frecuentes li {
      background: #fff;
      border: 1px solid #cce6ff;
      border-radius: 6px;
      padding: 7px 12px;
      color: #0077cc;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      box-shadow: 0 1px 2px #0077cc11;
      margin-bottom: 6px;
      width: 100%;
      box-sizing: border-box;
    }
    #consultas-frecuentes li:hover {
      background: #0077cc;
      color: #fff;
    }
    @media (max-width: 600px) {
      .container {
        max-width: 99vw;
        padding: 8vw 2vw;
      }
      #consultas-frecuentes {
        max-height: 90px;
        padding: 8px 6px;
      }
      #consultas-frecuentes li {
        font-size: 0.97rem;
        padding: 6px 8px;
      }
    }
  </style>
  <style>
    /* Estilos móviles al final para máxima prioridad */
    @media (max-width: 600px) {
      .container { max-width: 99vw; padding: 8vw 2vw; margin-top: 8px; }
      h2 { font-size: 1rem; }
      #historial, #historial .chat-item, #historial .user, #historial .bot, #historial .respuesta, #historial .respuesta-bot {
        font-size: 0.45rem !important;
        line-height: 1.35;
      }
      #historial { min-height: 120px; padding: 8px 4px; }
      #historial .chat-item { padding: 7px 5px; margin-bottom: 10px; }
      #historial .user, #historial .bot { gap: 4px; }
      #historial .respuesta, #historial .respuesta-bot { padding: 5px 7px; word-break: break-word; }
      #consultas-frecuentes { max-height: 110px; padding: 8px 6px; overflow-y: auto; font-size: 0.92rem; }
      #consultas-frecuentes li { font-size: 0.92rem; padding: 5px 7px; }
      input[type="text"] { font-size: 0.92rem; padding: 6px 8px; }
      button { font-size: 0.92rem; padding: 7px 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2><i class="fa-solid fa-robot"></i> Chatbot Vastec Web</h2>
    <form id="form">
      <label for="pregunta">Escribe tu consulta:</label>
      <input type="text" id="pregunta" name="pregunta" required autocomplete="off" placeholder="Ej: ¿Qué productos ofrece Vastec?">
      <div style="display:flex;gap:10px;margin-bottom:8px;">
        <button type="submit"><i class="fa-solid fa-paper-plane"></i> Consultar</button>
        <button type="button" id="limpiar"><i class="fa-solid fa-broom"></i> Limpiar chat</button>
        <button type="button" id="exportar"><i class="fa-solid fa-file-export"></i> Exportar historial</button>
      </div>
    </form>
    <div id="consultas-frecuentes">
      <h3><i class="fa-solid fa-lightbulb"></i> Consultas frecuentes</h3>
      <ul id="ejemplos">
        <!-- Los ejemplos se insertan dinámicamente -->
      </ul>
    </div>
    <div id="historial"></div>
  </div>
  <!-- Scripts al final para asegurar carga del DOM -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('form');
      const historialDiv = document.getElementById('historial');
      const ejemplosUl = document.getElementById('ejemplos');
      let historial = [];

      // Ejemplos dinámicos y empresariales
      const ejemplos = [
        '¿Qué productos ofrece Vastec?',
        '¿Cuál es la garantía de los productos?',
        '¿Dónde se ubica la oficina principal?',
        '¿Quién es el gerente general?',
        '¿Cuáles son los canales de distribución?',
        '¿Qué certificaciones tiene la empresa?',
        '¿Cómo contactar a ventas o soporte técnico?',
        '¿Qué alianzas tecnológicas tiene Vastec?',
        '¿Qué sectores atiende principalmente?',
        '¿Cuáles son los valores corporativos?',
        '¿Qué soluciones empresariales ofrecen?',
        '¿Cómo solicitar una cotización?',
        '¿Qué reconocimientos ha recibido Vastec?',
        '¿Cuál es la misión y visión de la empresa?',
        '¿Qué servicios de postventa tienen?'
      ];

      function renderEjemploItem(ej) {
        const li = document.createElement('li');
        li.textContent = ej;
        li.onclick = (e) => {
          e.preventDefault();
          document.getElementById('pregunta').value = ej;
          document.getElementById('pregunta').focus();
        };
        return li;
      }

      function renderEjemplos(mostrarTodos = false) {
        ejemplosUl.innerHTML = '';
        const lista = mostrarTodos ? ejemplos : ejemplos.slice(0, 3);
        lista.forEach(ej => ejemplosUl.appendChild(renderEjemploItem(ej)));
        let btn = document.getElementById('mostrar-mas');
        if (!btn) {
          btn = document.createElement('button');
          btn.id = 'mostrar-mas';
          btn.type = 'button';
          btn.style.marginTop = '10px';
          btn.style.background = '#e9f7fe';
          btn.style.color = '#0077cc';
          btn.style.border = '1px solid #cce6ff';
          btn.style.borderRadius = '6px';
          btn.style.padding = '7px 12px';
          btn.style.fontWeight = '500';
          btn.style.cursor = 'pointer';
          ejemplosUl.parentNode.appendChild(btn);
        }
        btn.textContent = mostrarTodos ? 'Mostrar menos consultas' : 'Mostrar más consultas';
        btn.onclick = (e) => {
          e.preventDefault();
          renderEjemplos(!mostrarTodos);
        };
        btn.style.display = ejemplos.length > 3 ? 'inline-block' : 'none';
      }
      renderEjemplos();

      function renderHistorial() {
        historialDiv.innerHTML = historial.map((item, idx) => {
          let respuestaLimpia = item.respuesta
            .replace(/<h2>/g, '<div style="font-weight:600;font-size:1.01rem;margin-bottom:4px;">')
            .replace(/<\/h2>/g, '</div>')
            .replace(/<p>/g, '<div style="margin-bottom:4px;">')
            .replace(/<\/p>/g, '</div>');
          return `<div class="chat-item" id="chat-item-${idx}">
            <div class="user"><i class="fa-solid fa-user"></i> ${item.timestamp} Tú:</div>
            <div class="respuesta">${item.pregunta}</div>
            <div class="bot"><i class="fa-solid fa-robot"></i> ${item.timestamp} Chatbot:</div>
            <div class="respuesta respuesta-bot">${respuestaLimpia}</div>
          </div>`;
        }).join('');
        setTimeout(() => {
          const last = document.getElementById(`chat-item-${historial.length-1}`);
          if (last) {
            last.scrollIntoView({ behavior: 'smooth', block: 'center' });
          } else {
            historialDiv.scrollTop = historialDiv.scrollHeight;
          }
        }, 50);
      }
      renderHistorial();

      // Validación de entrada y accesibilidad
      form.onsubmit = async (e) => {
        e.preventDefault();
        const preguntaInput = document.getElementById('pregunta');
        const pregunta = preguntaInput.value.trim();
        if (!pregunta) {
          preguntaInput.focus();
          return;
        }
        const timestamp = new Date().toLocaleTimeString();
        historial.push({ pregunta, respuesta: 'Consultando...', timestamp });
        renderHistorial();
        try {
          // URL absoluta del backend FastAPI en Codespaces
          const apiUrl = 'https://jubilant-carnival-j6vpgx5q4vrcppj-8000.app.github.dev/consulta';
          const res = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pregunta })
          });
          if (!res.ok) {
            throw new Error('Error HTTP: ' + res.status);
          }
          let data;
          try {
            data = await res.json();
          } catch (jsonErr) {
            historial[historial.length - 1].respuesta = 'Respuesta inválida del servidor.';
            renderHistorial();
            preguntaInput.value = '';
            return;
          }
          if (historial.length > 0) {
            historial[historial.length - 1].respuesta = data.respuesta || 'Sin respuesta.';
          }
          renderHistorial();
        } catch (err) {
          if (historial.length > 0) {
            historial[historial.length - 1].respuesta = 'Error al consultar la API.';
          }
          renderHistorial();
        }
        preguntaInput.value = '';
        preguntaInput.focus();
      };

      // Botón limpiar chat
      document.getElementById('limpiar').onclick = () => {
        historial = [];
        renderHistorial();
        document.getElementById('pregunta').focus();
      };

      // Botón exportar historial
      document.getElementById('exportar').onclick = () => {
        if (historial.length === 0) {
          alert('No hay historial para exportar.');
          return;
        }
        const texto = historial.map(item =>
          `${item.timestamp} Tú: ${item.pregunta}\n${item.timestamp} Chatbot: ${item.respuesta.replace(/<[^>]+>/g, '')}\n`
        ).join('\n');
        const blob = new Blob([texto], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'historial_chatbot.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };
    });
  </script>
